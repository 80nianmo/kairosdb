<!DOCTYPE html>
<html lang="en">
<head>
	<title>Roll-ups</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet"
		  href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

	<!-- todo download these locally -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>

	<script src="rollup-js/third-party/moment.js" type="text/javascript"></script>
	<script src="rollup-js/third-party/later.js" type="text/javascript"></script>
	<script src="rollup-js/third-party/prettycron.js" type="text/javascript"></script>
</head>

<body ng-app="myApp" ng-controller="rollupController">

<div class="container-fluid">
	<div class="page-header">
		<h1 class="text-center text-info">Roll-ups</h1>
	</div>
	<a href="#" ng-click="addRollupTask()"
	   class="btn btn-primary btn-lg btn-circle pull-right"><span
			class="glyphicon glyphicon-plus"></span></a>

	<table class="table table-striped" data-sort-name="metric-name"
		   data-sort-order="asc">
		<thead>
		<tr class="text-info">
			<th data-field="name" data-sortable="true">Roll-up Name</th>
			<th data-field="metric-name" data-sortable="true">Metric Name</th>
			<th data-field="execute" data-sortable="true">Execute</th>
			<th data-field="look-back" data-sortable="true">Look Back</th>
			<th data-field="aggregator" data-sortable="true">Aggregator</th>
			<th data-field="aggregator_sampling" data-sortable="true">Aggregator
				Sampling
			</th>
			<th data-field="target" data-sortable="true">Save As</th>
			<th></th>
		</tr>
		</thead>
		<tbody>
		<tr ng-repeat="rollup in tasks">
			<td>
				<span ng-hide="rollup.edit">{{ rollup.name }}</span>
				<input type='text' ng-model="rollup.name"
					   ng-hide="!rollup.edit"/>
			</td>

			<td>
				<span ng-hide="rollup.edit">{{ rollup.tasks[0].query.metrics[0].name }}</span>
				<input type='text'
					   ng-model="rollup.rollups[0].query.metrics[0].name"
					   ng-hide="!rollup.edit"/>
			</td>
			<td>
				<div class="dropdown">
					<button class="btn btn-default dropdown-toggle"
							type="button" id="executeDropdown"
							data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="true" ng-disabled="!rollup.edit">
						{{ toHumanReadableCron(rollup.schedule) }} <span
							class="caret"></span>
					</button>
					<ul class="dropdown-menu" aria-labelledby="executeDropdown">
						<li ng-repeat="executeTime in executeTimes">
							<a href="#"
							   ng-click="scheduleModified(rollup, executeTime)">
								{{ toHumanReadableCron(executeTime) }}
							</a>
						</li>
					</ul>
				</div>

			</td>
			<td>
				<div class="dropdown">
					<button class="btn btn-default dropdown-toggle"
							type="button" id="startTimeDropdown"
							data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="true" ng-disabled="!rollup.edit">
						{{
						toHumanReadableTimeUnit(rollup.tasks[0].query.start_relative)}}
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu"
						aria-labelledby="startTimeDropdown">
						<li ng-repeat="startTime in relativeStartTimes">
							<a href="#"
							   ng-click="startTimeModified(rollup, startTime)">
								{{ toHumanReadableTimeUnit(startTime) }}
							</a>
						</li>
					</ul>
				</div>
			</td>

			<td>
				<div class="dropdown">
					<button class="btn btn-default dropdown-toggle"
							type="button" id="aggregatorDropdown"
							data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="true" ng-disabled="!rollup.edit">
						{{
						rollup.tasks[0].query.metrics[0].aggregators[0].name
						}}
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu"
						aria-labelledby="aggregatorDropdown">
						<li ng-repeat="aggregator in aggregators">
							<a href="#"
							   ng-click="aggregatorModified(rollup, aggregator)">
								{{ aggregator }}
							</a>
						</li>
					</ul>
				</div>
			</td>

			<td>
				<div class="dropdown">
					<button class="btn btn-default dropdown-toggle"
							type="button" id="aggregatorSamplingDropdown"
							data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="true" ng-disabled="!rollup.edit">
						{{
						toHumanReadableTimeUnit(rollup.tasks[0].query.metrics[0].aggregators[0].sampling)
						}}
						<span class="caret"></span>
					</button>
					<ul class="dropdown-menu"
						aria-labelledby="aggregatorSamplingDropdown">
						<li ng-repeat="time in samplingTimes">
							<a href="#"
							   ng-click="aggregatorSamplingModified(rollup, time)">
								{{ toHumanReadableTimeUnit(time) }}
							</a>
						</li>
					</ul>
				</div>
			</td>

			<td>
				<span ng-hide="rollup.edit">{{ rollup.tasks[0].save_as}}</span>
				<input type='text' ng-model="rollup.rollups[0].save_as"
					   ng-hide="!rollup.edit"/>
			</td>
			<td>
				<button class="btn btn-primary"
						ng-click="editRollupTask(rollup)"
						ng-hide="rollup.edit">
					<span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;Edit
				</button>
				<button class="btn btn-success"
						ng-click="saveRollupTask(rollup)"
						ng-hide="!rollup.edit">
					<span class="glyphicon glyphicon-save"></span>&nbsp;&nbsp;Save
				</button>
			</td>
			<td>
				<button class="btn btn-primary"
						ng-click="deleteRollupTask(rollup)">
					<span class="glyphicon glyphicon-remove"></span>&nbsp;&nbsp;Delete
				</button>

			</td>
			<td></td>
		</tr>
		</tbody>
	</table>
</div>

<script src="rollup-js/rollup.js"></script>
</body>
</html>
